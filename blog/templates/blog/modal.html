<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge">
    {% load staticfiles %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>模态框测试</title>
{#    <bootstrap>#}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

</head>
<body>
    <p>测试成功</p>
    <button type="button" id="btn-modal" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">加载测试模态框</button>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">新的评论</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="id_name" class="control-label">用户名：</label>
                            <div class="sr-only" id="miss_name" role="alert">
                                <p>用户名不能为空</p>
                            </div>
                            <input type="text" class="form-control" id="id_name" placeholder="请输入您的用户名">
                        </div>
                        <div class="form-group">
                            <label for="id_content" class="control-label">内容:</label>
                            <div class="sr-only" id="miss_content" role="alert">
                                <p>评论内容不能为空</p>
                            </div>
                            <textarea class="form-control" id="id_content" placeholder="请输入您的评论内容"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" id="comment-submit" class="btn btn-primary">评论</button>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'jquery/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script>
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
        });

        $("#myModal #comment-submit").on('click', function(e){
            $(this).attr('disabled', 'disabled');
            var name=$("#myModal #id_name").val();
            var content=$("#myModal #id_content").val();
            if (name==''){
                $('#myModal #miss_name').attr('class', 'alert alert-danger');
            }
            else if(content==''){
                $('#myModal #miss_content').attr('class', 'alert alert-danger');
            }
            else{
                $.ajax({
                    type:"POST",
                    data: {name:name, content:content},
                    url: "{% url 'blog:comments_upload' %}",
                    cache: false,
                    dataType: "html",
                    success: function(result, statues, xml){
                        alert(result);
                    },
                    error: function() {
                        alert("false");
                    }
                });
            $("#myModal").modal("hide");
            $('#myModal #miss_name').attr('class', 'sr-only');
            $('#myModal #miss_content').attr('class', 'sr-only');
            $("#myModal #id_name").val('');
            $("#myModal #id_content").val('');
            }
            $(this).removeAttr('disabled');

        });
{#        $("btn-modal").on('click', function(){#}
{#            $("#myModal").modal("show");#}
{#        });#}
    </script>
</body>
</html>